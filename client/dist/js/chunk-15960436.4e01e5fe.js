(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-15960436"],{"02bc":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"view"},[r("FilterItem",{attrs:{prop:e.propFilterItem},on:{"update:prop":function(t){e.propFilterItem=t},emit:e.emitFilterItem}}),r("Table",{attrs:{prop:e.propTable},on:{emit:e.emitTable}}),r("Pagination",{attrs:{prop:e.propPagination},on:{"update:prop":function(t){e.propPagination=t},emit:e.emitPagination}}),e.isShowDialog?r("Dialog",{attrs:{isShow:e.isShowDialog,prop:e.propDialog},on:{"update:isShow":function(t){e.isShowDialog=t},"update:is-show":function(t){e.isShowDialog=t},emit:e.emitDialog}}):e._e()],1)},l=[],o=(r("96cf"),r("3b8d")),i=r("d225"),n=r("b0b4"),s=r("308d"),u=r("6bb5"),c=r("4e2b"),p=r("9ab4"),m=r("60a3"),d=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"view"},[r("el-table",{attrs:{data:e.prop.tableData,border:""}},[r("el-table-column",{attrs:{type:"index",label:"序号",width:"50",align:"center"}}),r("el-table-column",{attrs:{prop:"name",label:"名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("a",{attrs:{href:t.row.url}},[e._v(e._s(t.row.name))])]}}])}),r("el-table-column",{attrs:{prop:"src_url",label:"抓取地址",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("a",{attrs:{href:t.row.src_url}},[e._v(e._s(t.row.src_url))])]}}])}),r("el-table-column",{attrs:{prop:"source_info",label:"源站名称",align:"center"}}),r("el-table-column",{attrs:{prop:"is_two_layers",label:"层级",align:"center"}}),r("el-table-column",{attrs:{prop:"collect_total",label:"采集总数",align:"center"}}),r("el-table-column",{attrs:{prop:"collected",label:"最后采集时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.getDateTime(t.row.collected)))])]}}])}),"visitor"!==e.$store.state.user.role?r("el-table-column",{attrs:{label:"操作",align:"center",fixed:"right",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"small",type:"warning",icon:"edit"},on:{click:function(r){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),r("el-button",{attrs:{size:"small",type:"danger",icon:"delete"},on:{click:function(r){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}],null,!1,1634008102)}):e._e()],1)],1)},g=[],f=r("1aab"),h=function(e){function t(){return Object(i["a"])(this,t),Object(s["a"])(this,Object(u["a"])(t).apply(this,arguments))}return Object(c["a"])(t,e),Object(n["a"])(t,[{key:"handleDelete",value:function(e,t){this.emit({method:"delete",index:e,id:t._id})}},{key:"handleEdit",value:function(e,t){this.emit({method:"patch",title:"编辑",index:e,ruleForm:t})}},{key:"emit",value:function(e){this.$emit("emit",e)}}]),t}(Object(m["b"])(f["b"]));p["a"]([Object(m["c"])()],h.prototype,"prop",void 0),h=p["a"]([Object(m["a"])({components:{}})],h);var b=h,_=b,v=r("2877"),y=Object(v["a"])(_,d,g,!1,null,null,null),F=y.exports,k=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"view"},[r("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,inline:!0}},[r("el-form-item",{attrs:{label:"规则名称"}},[r("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),r("el-form-item",{attrs:{label:"采集类别"}},[r("el-select",{model:{value:e.ruleForm.category,callback:function(t){e.$set(e.ruleForm,"category",t)},expression:"ruleForm.category"}},e._l(e.format_type_list,function(e,t){return r("el-option",{key:t,attrs:{label:e.name,value:e.url}})}),1)],1),r("el-form-item",{attrs:{label:"层级"}},[r("el-select",{model:{value:e.ruleForm.is_two_layers,callback:function(t){e.$set(e.ruleForm,"is_two_layers",t)},expression:"ruleForm.is_two_layers"}},e._l(e.is_two_layers,function(e,t){return r("el-option",{key:t,attrs:{label:e.name,value:e.value}})}),1)],1),r("el-form-item",{attrs:{label:"采集时间"}},[r("el-date-picker",{attrs:{type:"datetime",placeholder:"请选择开始时间"},model:{value:e.ruleForm.collected__date__gte,callback:function(t){e.$set(e.ruleForm,"collected__date__gte",t)},expression:"ruleForm.collected__date__gte"}}),e._v("-- "),r("el-date-picker",{attrs:{type:"datetime",placeholder:"请选择结束时间"},model:{value:e.ruleForm.collected__date__lte,callback:function(t){e.$set(e.ruleForm,"collected__date__lte",t)},expression:"ruleForm.collected__date__lte"}})],1),r("el-form-item",[r("el-button",{attrs:{type:e.prop.active?"primary":"default"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("筛选")]),r("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")])],1)],1)],1)},x=[],w=function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(s["a"])(this,Object(u["a"])(t).apply(this,arguments)),e.ruleForm={name:"",collected__date__gte:"",collected__date__lte:""},e.rules={},e.format_type_list=[{url:"http://goodhope-spider-manage.herokuapp.com/api/extend/collection-categories/1/",name:"活动",created:"2019-08-09T01:35:38+08:00"},{url:"http://goodhope-spider-manage.herokuapp.com/api/extend/collection-categories/1/",name:"活动",created:"2019-08-09T01:35:38+08:00"}],e.is_two_layers=[{name:"单层",value:"0"},{name:"双层",value:"1"},{name:"全站",value:"2"}],e}return Object(c["a"])(t,e),Object(n["a"])(t,[{key:"created",value:function(){}},{key:"submitForm",value:function(e){var t=this;this.$refs[e].validate(function(e){e&&(t.$emit("update:prop",{ruleForm:t.ruleForm,active:!0}),t.emit({data:{filterFields:t.ruleForm},method:"get"}))})}},{key:"handleAdd",value:function(){this.emit({method:"post",title:"新增"})}},{key:"emit",value:function(e){this.$emit("emit",e)}}]),t}(m["d"]);p["a"]([Object(m["c"])()],w.prototype,"prop",void 0),w=p["a"]([Object(m["a"])({components:{}})],w);var O=w,j=O,$=Object(v["a"])(j,k,x,!1,null,null,null),S=$.exports,D=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"view"},[r("el-pagination",{attrs:{"current-page":e.prop.pagination.page_index,"page-sizes":e.prop.pagination.page_sizes,"page-size":e.prop.pagination.page_size,layout:e.prop.pagination.layout,total:e.prop.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.prop.pagination,"page_index",t)},"update:current-page":function(t){return e.$set(e.prop.pagination,"page_index",t)}}})],1)},q=[],P=(r("8e6e"),r("ac6a"),r("456d"),r("bd86"));function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(r,!0).forEach(function(t){Object(P["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var T=function(e){function t(){return Object(i["a"])(this,t),Object(s["a"])(this,Object(u["a"])(t).apply(this,arguments))}return Object(c["a"])(t,e),Object(n["a"])(t,[{key:"created",value:function(){}},{key:"handleSizeChange",value:function(e){this.executeEmit({page_size:e,page_index:1})}},{key:"handleCurrentChange",value:function(e){this.executeEmit()}},{key:"executeEmit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$emit("update:prop",{pagination:C({},Object.assign(this.prop.pagination,e))}),this.emit({})}},{key:"emit",value:function(e){this.$emit("emit",e)}}]),t}(m["d"]);p["a"]([Object(m["c"])()],T.prototype,"prop",void 0),T=p["a"]([Object(m["a"])({components:{}})],T);var z=T,A=z,I=Object(v["a"])(A,D,q,!1,null,null,null),R=I.exports,N=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"view"},[r("el-dialog",{attrs:{title:e.prop.title,visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[r("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules},on:{submit:function(t){return t.preventDefault(),e.onSubmit(t)}}},[r("el-form-item",{attrs:{prop:"name",label:"规则名称"}},[r("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),r("el-form-item",{attrs:{prop:"source_info",label:"所属源站"}},[r("el-autocomplete",{attrs:{placeholder:"模糊搜索","fetch-suggestions":e.querySearchAsync},model:{value:e.ruleForm.source_info,callback:function(t){e.$set(e.ruleForm,"source_info","string"===typeof t?t.trim():t)},expression:"ruleForm.source_info"}})],1),r("el-form-item",{attrs:{label:"采集类别",prop:"category"}},[r("el-input",{model:{value:e.ruleForm.category,callback:function(t){e.$set(e.ruleForm,"category",t)},expression:"ruleForm.category"}})],1),r("el-form-item",{attrs:{label:"层级",prop:"is_two_layers"}},[r("el-input",{model:{value:e.ruleForm.is_two_layers,callback:function(t){e.$set(e.ruleForm,"is_two_layers",t)},expression:"ruleForm.is_two_layers"}})],1),r("el-form-item",{attrs:{label:"页面类型",prop:"page_type"}},[r("el-radio",{attrs:{label:"0"},model:{value:e.ruleForm.page_type,callback:function(t){e.$set(e.ruleForm,"page_type",t)},expression:"ruleForm.page_type"}},[e._v("静态")]),r("el-radio",{attrs:{label:"1"},model:{value:e.ruleForm.page_type,callback:function(t){e.$set(e.ruleForm,"page_type",t)},expression:"ruleForm.page_type"}},[e._v("动态")]),r("el-radio",{attrs:{label:"2"},model:{value:e.ruleForm.page_type,callback:function(t){e.$set(e.ruleForm,"page_type",t)},expression:"ruleForm.page_type"}},[e._v("api")])],1),"2"!==e.ruleForm.page_type?r("el-form-item",{attrs:{prop:"src_url",label:"采集地址(仅在非api请求下):"}},[r("el-input",{model:{value:e.ruleForm.src_url,callback:function(t){e.$set(e.ruleForm,"src_url",t)},expression:"ruleForm.src_url"}})],1):e._e(),r("el-form-item",{attrs:{prop:"restrict_xpath",label:"限制区域:"}},[r("el-input",{model:{value:e.ruleForm.restrict_xpath,callback:function(t){e.$set(e.ruleForm,"restrict_xpath",t)},expression:"ruleForm.restrict_xpath"}})],1),r("el-form-item",{attrs:{prop:"allow",label:"允许的正则链接:"}},[r("el-input",{model:{value:e.ruleForm.allow,callback:function(t){e.$set(e.ruleForm,"allow",t)},expression:"ruleForm.allow"}})],1),r("el-form-item",{attrs:{prop:"title_xpath",label:"标题位置:"}},[r("el-input",{model:{value:e.ruleForm.title_xpath,callback:function(t){e.$set(e.ruleForm,"title_xpath",t)},expression:"ruleForm.title_xpath"}})],1),r("el-form-item",{attrs:{prop:"content_xpath",label:"内容位置:"}},[r("el-input",{model:{value:e.ruleForm.content_xpath,callback:function(t){e.$set(e.ruleForm,"content_xpath",t)},expression:"ruleForm.content_xpath"}})],1),r("el-form-item",{attrs:{prop:"api_url",label:"接口地址:"}},[r("el-input",{model:{value:e.ruleForm.api_url,callback:function(t){e.$set(e.ruleForm,"api_url",t)},expression:"ruleForm.api_url"}})],1),r("el-form-item",{attrs:{prop:"remarks",label:"备注:"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.remarks,callback:function(t){e.$set(e.ruleForm,"remarks",t)},expression:"ruleForm.remarks"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",round:""},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确认")])],1)],1)],1)],1)},J=[],L=(r("6b54"),function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(s["a"])(this,Object(u["a"])(t).apply(this,arguments)),e.ruleForm={id:"",name:"",source_info:"",category:"",is_two_layers:"",page_type:"",src_url:"",restrict_xpath:"",allow:"",title_xpath:"",content_xpath:"",api_url:"",remarks:""},e.rules={name:{required:!0,message:"请输入",trigger:"blur"},source_info:[{required:!0,message:"请输入",trigger:["blur","change"]},{trigger:"blur",validator:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(r,a,l,o,i){var n,s,u;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return n=[],t.next=3,e.$request({api:"/sourceInfos/",data:{querySearchField:"name",querySearchValue:a},method:"get"});case 3:s=t.sent,s.status>=200&&s.status<400&&(u=s.data.results||[],u.length<=0&&(n.push("请输入已存在的源站地址"),e.$message({message:"“所属源站”字段输入框：请输入已存在的源站地址",type:"error"}))),l(n);case 6:case"end":return t.stop()}},t)}));function r(e,r,a,l,o){return t.apply(this,arguments)}return r}()}],category:{required:!0,message:"请输入",trigger:"blur"},is_two_layers:{required:!0,message:"请输入",trigger:"blur"},page_type:{required:!0,message:"请输入",trigger:"blur"},src_url:{required:!0,trigger:"blur",message:"请输入"},restrict_xpath:{required:!0,trigger:"blur",message:"请输入"},allow:{required:!0,trigger:"blur",message:"请输入"},title_xpath:{required:!0,trigger:"blur",message:"请输入"},content_xpath:{required:!0,trigger:"blur",message:"请输入"},api_url:{required:!0,trigger:"blur",message:"请输入"}},e.allName=[],e.allNameBackup=[],e.timeout=null,e}return Object(c["a"])(t,e),Object(n["a"])(t,[{key:"created",value:function(){"patch"===this.prop.method&&(this.ruleForm=this.prop.ruleForm)}},{key:"mounted",value:function(){this.loadAllName()}},{key:"submitForm",value:function(e){var t=this;this.$refs[e].validate(function(e){e&&(t.emit({data:t.ruleForm,method:t.prop.method}),t.visible=!1)})}},{key:"querySearchAsync",value:function(e,t){var r=this.allName,a=e?r.filter(this.createStateFilter(e)):r;clearTimeout(this.timeout),this.timeout=setTimeout(function(){t(a)},1e3*Math.random())}},{key:"createStateFilter",value:function(e){return function(t){return 0===t.value.toString().toLowerCase().indexOf(e.toLowerCase())}}},{key:"loadAllName",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$request({api:"/sourceInfos/",data:{querySearchField:"name",querySearchValue:""},method:"get"});case 2:t=e.sent,t.status>=200&&t.status<400&&(this.allName=t.data.results,console.log("this.allName",this.allName));case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"emit",value:function(e){this.$emit("emit",e)}},{key:"visible",get:function(){return this.isShow},set:function(e){this.$emit("update:isShow",e)}}]),t}(m["d"]));p["a"]([Object(m["c"])()],L.prototype,"prop",void 0),p["a"]([Object(m["c"])()],L.prototype,"isShow",void 0),L=p["a"]([Object(m["a"])({components:{}})],L);var V=L,B=V,M=(r("f478"),Object(v["a"])(B,N,J,!1,null,"3dd1dd7e",null)),G=M.exports,H=function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(s["a"])(this,Object(u["a"])(t).apply(this,arguments)),e.propTable={tableData:[]},e.propFilterItem={ruleForm:{name:"",collected__date__gte:"",collected__date__lte:""},active:!1},e.propPagination={pagination:{page_index:1,total:0,page_size:5,page_sizes:[5,10,15,20],layout:"total,sizes,prev,pager,next,jumper"}},e.isShowDialog=!1,e.propDialog={},e}return Object(c["a"])(t,e),Object(n["a"])(t,[{key:"created",value:function(){this.requestApi()}},{key:"emitTable",value:function(e){"delete"==e.method&&this.requestApi(e),"patch"==e.method&&(this.propDialog=e,this.isShowDialog=!0)}},{key:"emitFilterItem",value:function(e){if(this.propPagination.pagination.page_index=1,"get"===e.method){var t=e.data;this.requestApi({data:t})}"post"===e.method&&(this.propDialog=e,this.isShowDialog=!0)}},{key:"emitPagination",value:function(e){this.requestApi()}},{key:"emitDialog",value:function(e){"post"===e.method&&(this.propPagination.pagination.page_index=1,this.propFilterItem.active=!1),this.requestApi(e)}},{key:"requestApi",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t,r,a,l,o,i,n,s,u,c,p=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:{},r=t.data,a=void 0===r?{}:r,l=t.method,o=void 0===l?"get":l,i=t.index,n=void 0===i?0:i,s=a._id||t.id||"",Object.assign(a,this.propPagination),!0===this.propFilterItem.active&&(a.filterFields=this.propFilterItem.ruleForm),e.next=7,this.$request({api:"/rulesConfig/"+s,data:a,method:o});case 7:u=e.sent,u.status>=200&&u.status<300&&(c=u.data,c.pagination&&(this.propPagination.pagination.total=c.pagination.total),"post"===o?(this.$message({message:"新增成功",type:"success"}),this.propTable.tableData=c.results):"delete"==o?(this.propTable.tableData.splice(n,1),this.propPagination.pagination.total--,this.$message({message:"删除成功",type:"success"})):"patch"==o?this.$message({message:"修改成功",type:"success"}):"get"==o&&(this.propTable.tableData=c.results));case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()}]),t}(m["d"]);H=p["a"]([Object(m["a"])({components:{Table:F,FilterItem:S,Pagination:R,Dialog:G}})],H);var K=H,Q=K,U=Object(v["a"])(Q,a,l,!1,null,null,null);t["default"]=U.exports},3846:function(e,t,r){r("9e1e")&&"g"!=/./g.flags&&r("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:r("0bfb")})},"556c":function(e,t,r){},"6b54":function(e,t,r){"use strict";r("3846");var a=r("cb7c"),l=r("0bfb"),o=r("9e1e"),i="toString",n=/./[i],s=function(e){r("2aba")(RegExp.prototype,i,e,!0)};r("79e5")(function(){return"/a/b"!=n.call({source:"a",flags:"b"})})?s(function(){var e=a(this);return"/".concat(e.source,"/","flags"in e?e.flags:!o&&e instanceof RegExp?l.call(e):void 0)}):n.name!=i&&s(function(){return n.call(this)})},f478:function(e,t,r){"use strict";var a=r("556c"),l=r.n(a);l.a}}]);